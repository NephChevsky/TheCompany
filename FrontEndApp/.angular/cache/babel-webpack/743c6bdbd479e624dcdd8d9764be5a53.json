{"ast":null,"code":"import { EventEmitter } from '@angular/core';\nimport { FormControl, FormGroup } from '@angular/forms';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"src/app/_services/view-list.service\";\nimport * as i2 from \"@angular/router\";\nimport * as i3 from \"@angular/forms\";\nimport * as i4 from \"@angular/common\";\nimport * as i5 from \"../field/field.component\";\n\nfunction ViewListComponent_th_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"th\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const field_r4 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(field_r4);\n  }\n}\n\nfunction ViewListComponent_tbody_4_tr_1_td_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r11 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"td\");\n    i0.ɵɵelementStart(1, \"app-field\", 7);\n    i0.ɵɵlistener(\"focusEvent\", function ViewListComponent_tbody_4_tr_1_td_1_Template_app_field_focusEvent_1_listener($event) {\n      i0.ɵɵrestoreView(_r11);\n      const ctx_r10 = i0.ɵɵnextContext(3);\n      return ctx_r10.onFocus($event);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const field_r9 = ctx.$implicit;\n    const index_r7 = i0.ɵɵnextContext().index;\n    const ctx_r8 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵpropertyInterpolate(\"type\", field_r9.type);\n    i0.ɵɵpropertyInterpolate(\"key\", field_r9.name);\n    i0.ɵɵproperty(\"form\", ctx_r8.getItem(index_r7))(\"index\", index_r7)(\"editMode\", ctx_r8.editMode);\n  }\n}\n\nconst _c0 = function (a0) {\n  return {\n    \"linkable\": a0\n  };\n};\n\nfunction ViewListComponent_tbody_4_tr_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r14 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"tr\", 6);\n    i0.ɵɵlistener(\"click\", function ViewListComponent_tbody_4_tr_1_Template_tr_click_0_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r14);\n      const line_r6 = restoredCtx.$implicit;\n      const ctx_r13 = i0.ɵɵnextContext(2);\n      return ctx_r13.linkable && !ctx_r13.editMode && ctx_r13.show(line_r6.linkValue);\n    });\n    i0.ɵɵtemplate(1, ViewListComponent_tbody_4_tr_1_td_1_Template, 2, 5, \"td\", 1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const line_r6 = ctx.$implicit;\n    const ctx_r5 = i0.ɵɵnextContext(2);\n    i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction1(2, _c0, ctx_r5.linkable && !ctx_r5.editMode));\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", line_r6.fields);\n  }\n}\n\nfunction ViewListComponent_tbody_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tbody\", 4);\n    i0.ɵɵtemplate(1, ViewListComponent_tbody_4_tr_1_Template, 2, 4, \"tr\", 5);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.data);\n  }\n}\n\nfunction ViewListComponent_tbody_5_tr_1_td_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r22 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"td\");\n    i0.ɵɵelementStart(1, \"app-field\", 7);\n    i0.ɵɵlistener(\"focusEvent\", function ViewListComponent_tbody_5_tr_1_td_1_Template_app_field_focusEvent_1_listener($event) {\n      i0.ɵɵrestoreView(_r22);\n      const ctx_r21 = i0.ɵɵnextContext(3);\n      return ctx_r21.onFocus($event);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const field_r19 = ctx.$implicit;\n    const index_r17 = i0.ɵɵnextContext().index;\n    const ctx_r18 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵpropertyInterpolate(\"type\", ctx_r18.getFieldType(field_r19));\n    i0.ɵɵpropertyInterpolate(\"key\", field_r19);\n    i0.ɵɵproperty(\"form\", ctx_r18.getItem(index_r17))(\"index\", index_r17)(\"editMode\", ctx_r18.editMode);\n  }\n}\n\nfunction ViewListComponent_tbody_5_tr_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\", 9);\n    i0.ɵɵtemplate(1, ViewListComponent_tbody_5_tr_1_td_1_Template, 2, 5, \"td\", 1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const index_r17 = ctx.index;\n    const ctx_r15 = i0.ɵɵnextContext(2);\n    i0.ɵɵproperty(\"formGroupName\", index_r17);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r15.fields);\n  }\n}\n\nfunction ViewListComponent_tbody_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tbody\", 4);\n    i0.ɵɵtemplate(1, ViewListComponent_tbody_5_tr_1_Template, 2, 2, \"tr\", 8);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r2.values.controls);\n  }\n}\n\nfunction ViewListComponent_tr_6_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r25 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"tr\");\n    i0.ɵɵelementStart(1, \"td\", 10);\n    i0.ɵɵelementStart(2, \"button\", 11);\n    i0.ɵɵlistener(\"click\", function ViewListComponent_tr_6_Template_button_click_2_listener() {\n      i0.ɵɵrestoreView(_r25);\n      const ctx_r24 = i0.ɵɵnextContext();\n      return ctx_r24.createNewLine();\n    });\n    i0.ɵɵtext(3, \"Add line\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n}\n\nexport let ViewListComponent = /*#__PURE__*/(() => {\n  class ViewListComponent {\n    constructor(viewListService, router, formBuilder) {\n      this.viewListService = viewListService;\n      this.router = router;\n      this.formBuilder = formBuilder;\n      this.dataSource = \"\";\n      this.linkable = false;\n      this.linkRoute = \"\";\n      this.filters = [];\n      this.fields = [];\n      this.editMode = false;\n      this.focusEvent = new EventEmitter();\n      this.data = [];\n      this.fieldsData = [];\n    }\n\n    ngOnInit() {\n      if (this.linesForm == null) {\n        this.linesForm = new FormGroup({});\n      }\n\n      if (this.linesForm.get(\"values\") == null) {\n        this.linesForm.addControl(\"values\", this.formBuilder.array([]));\n      }\n\n      this.viewListService.getResults(this.dataSource, this.filters, this.fields).subscribe(x => {\n        this.data = x.items;\n        this.fieldsData = x.fieldsData;\n        var items = this.linesForm.get(\"values\");\n\n        for (var i = 0; i < this.data.length; i++) {\n          var controls = this.formBuilder.group({});\n          controls.addControl(\"Id\", new FormControl(this.data[i].linkValue));\n\n          for (var j = 0; j < this.data[i].fields.length; j++) {\n            controls.addControl(this.data[i].fields[j].name, new FormControl(this.data[i].fields[j].value));\n          }\n\n          items.push(controls);\n        }\n      });\n    }\n\n    show(id) {\n      this.router.navigate([this.linkRoute + id]);\n    }\n\n    createNewLine() {\n      const tmpForm = this.formBuilder.group({});\n      tmpForm.addControl(\"Id\", new FormControl(\"\"));\n\n      for (var i = 0; i < this.fields.length; i++) {\n        tmpForm.addControl(this.fields[i], new FormControl(\"\"));\n      }\n\n      this.linesForm.get(\"values\").push(tmpForm);\n    }\n\n    get values() {\n      return this.linesForm.controls[\"values\"];\n    }\n\n    getItem(index) {\n      var test = this.linesForm.controls[\"values\"].at(index);\n      return test;\n    }\n\n    getFieldType(name) {\n      return this.fieldsData.find(x => x.name == name).type;\n    }\n\n    onFocus(target) {\n      if (this.editMode) this.focusEvent.emit(target);\n    }\n\n  }\n\n  ViewListComponent.ɵfac = function ViewListComponent_Factory(t) {\n    return new (t || ViewListComponent)(i0.ɵɵdirectiveInject(i1.ViewListService), i0.ɵɵdirectiveInject(i2.Router), i0.ɵɵdirectiveInject(i3.FormBuilder));\n  };\n\n  ViewListComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: ViewListComponent,\n    selectors: [[\"app-view-list\"]],\n    inputs: {\n      dataSource: \"dataSource\",\n      linkable: \"linkable\",\n      linkRoute: \"linkRoute\",\n      filters: \"filters\",\n      fields: \"fields\",\n      editMode: \"editMode\",\n      linesForm: \"linesForm\"\n    },\n    outputs: {\n      focusEvent: \"focusEvent\"\n    },\n    decls: 7,\n    vars: 5,\n    consts: [[3, \"formGroup\"], [4, \"ngFor\", \"ngForOf\"], [\"formArrayName\", \"values\", 4, \"ngIf\"], [4, \"ngIf\"], [\"formArrayName\", \"values\"], [3, \"ngClass\", \"click\", 4, \"ngFor\", \"ngForOf\"], [3, \"ngClass\", \"click\"], [\"size\", \"15\", 3, \"type\", \"form\", \"index\", \"key\", \"editMode\", \"focusEvent\"], [3, \"formGroupName\", 4, \"ngFor\", \"ngForOf\"], [3, \"formGroupName\"], [\"colspan\", \"100%\"], [1, \"btn\", \"btn-primary\", 3, \"click\"]],\n    template: function ViewListComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"form\", 0);\n        i0.ɵɵelementStart(1, \"table\");\n        i0.ɵɵelementStart(2, \"tr\");\n        i0.ɵɵtemplate(3, ViewListComponent_th_3_Template, 2, 1, \"th\", 1);\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(4, ViewListComponent_tbody_4_Template, 2, 1, \"tbody\", 2);\n        i0.ɵɵtemplate(5, ViewListComponent_tbody_5_Template, 2, 1, \"tbody\", 2);\n        i0.ɵɵtemplate(6, ViewListComponent_tr_6_Template, 4, 0, \"tr\", 3);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵproperty(\"formGroup\", ctx.linesForm);\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"ngForOf\", ctx.fields);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", !ctx.editMode);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.editMode);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.editMode);\n      }\n    },\n    directives: [i3.ɵNgNoValidate, i3.NgControlStatusGroup, i3.FormGroupDirective, i4.NgForOf, i4.NgIf, i3.FormArrayName, i4.NgClass, i5.FieldComponent, i3.FormGroupName],\n    styles: [\"table[_ngcontent-%COMP%]{margin:10px}td[_ngcontent-%COMP%], th[_ngcontent-%COMP%]{border:1px black solid;padding:5px}.linkable[_ngcontent-%COMP%]{cursor:pointer}\"]\n  });\n  return ViewListComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}